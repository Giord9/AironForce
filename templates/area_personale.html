{% extends "base.html" %}

{% block title %}Area Personale{% endblock %}

{% block content %}
<h1>Benvenuto, {{ user }}</h1>

<h2>Le tue prenotazioni</h2>

{% if prenotazioni %}
  <ul>
    {% for p in prenotazioni %}
      <li>
        {{ p.servizio }} - {{ p.giorno }} alle {{ p.ora }}
        <button class="btn-cancella" data-servizio="{{ p.servizio }}" data-giorno="{{ p.giorno }}" data-ora="{{ p.ora }}">Cancella</button>
      </li>
    {% endfor %}
  </ul>
{% else %}
  <p>Non hai prenotazioni.</p>
{% endif %}

<script>
  document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('.btn-cancella').forEach(btn => {
      btn.addEventListener('click', () => {
        if (confirm('Sei sicuro di voler cancellare questa prenotazione?')) {
          fetch('/cancella_prenotazione', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              servizio: btn.dataset.servizio,
              giorno: btn.dataset.giorno,
              ora: btn.dataset.ora
            })
          }).then(resp => {
            if (resp.ok) {
              alert('Prenotazione cancellata con successo.');
              location.reload();
            } else {
              alert('Errore durante la cancellazione.');
            }
          });
        }
      });
    });
  });
</script>

{% endblock %}
