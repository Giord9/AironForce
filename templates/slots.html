{% extends "base.html" %}

{% block title %}{{ nome }}{% endblock %}

{% block content %}
<h1>{{ nome }}</h1>
<div id='calendar'></div>

<script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css" rel="stylesheet" />

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const calendarEl = document.getElementById('calendar');

    // Dati slot: array di oggetti {coach, giorno, ora}
    const slotSet = {{ slot_settimanali | tojson }};
    console.log("slotSet:", slotSet);

    // Raggruppa per giorno della settimana
    const slotsByDay = {};

    slotSet.forEach(slot => {
      if (!slotsByDay[slot.giorno]) {
        slotsByDay[slot.giorno] = [];
      }
      slotsByDay[slot.giorno].push({ora: slot.ora, coach: slot.coach});
    });

    console.log("slotsByDay:", slotsByDay);

    const weekdayMap = {
      "Lunedì": 1,
      "Martedì": 2,
      "Mercoledì": 3,
      "Giovedì": 4,
      "Venerdì": 5,
      "Sabato": 6,
      "Domenica": 0
    };

    const events = [];

    // Crea eventi per ogni slot
    for (let giorno in slotsByDay) {
      let dow = weekdayMap[giorno];
      slotsByDay[giorno].forEach(slot => {
        events.push({
          title: slot.coach, // Mostra il nome del coach
          startTime: slot.ora,
          endTime: `${String(parseInt(slot.ora.slice(0, 2)) + 1).padStart(2, '0')}:00`,
          daysOfWeek: [dow],
          backgroundColor: '#28a745',
          borderColor: '#1e7e34',
          display: 'auto',
        });
      });
    }

    // Inizializza il calendario FullCalendar
    const calendar = new FullCalendar.Calendar(calendarEl, {
      initialView: 'timeGridWeek',
      slotMinTime: "08:00:00",
      slotMaxTime: "21:00:00",
      allDaySlot: false,
      events: events,
      selectable: true,
      select: function(info) {
        alert('Hai selezionato lo slot: ' + info.startStr);
      }
    });

    calendar.render();
  });
</script>
{% endblock %}
