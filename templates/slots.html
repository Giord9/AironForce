{% extends "base.html" %}

{% block title %}{{ nome }}{% endblock %}

{% block content %}
<h1>{{ nome }}</h1>
<div id='calendar'></div>

<script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css" rel="stylesheet" />

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const calendarEl = document.getElementById('calendar');

    const slotSet = {{ slot_settimanali | tojson }};
    const weekdayMap = {
      "Lunedì": 1, "Martedì": 2, "Mercoledì": 3, "Giovedì": 4,
      "Venerdì": 5, "Sabato": 6, "Domenica": 0
    };

    const events = [];

    for (let giorno in slotSet) {
      let dow = weekdayMap[giorno];
      slotSet[giorno].forEach(ora => {
        events.push({
          title: 'Raffaella Esposito',
          startTime: ora,
          endTime: `${parseInt(ora.slice(0,2)) + 1}:00`,
          daysOfWeek: [dow],
          backgroundColor: '#28a745',
          borderColor: '#1e7e34',
          display: 'auto',
        });
      });
    }

    const calendar = new FullCalendar.Calendar(calendarEl, {
      initialView: 'timeGridWeek',
      slotMinTime: "08:00:00",
      slotMaxTime: "21:00:00",
      allDaySlot: false,
      events: events,
      selectable: true,
      select: function(info) {
        alert('Hai selezionato lo slot: ' + info.startStr);
      }
    });

    calendar.render();
  });
</script>
{% endblock %}
